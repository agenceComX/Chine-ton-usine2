import{q as f,i as m,k as l,l as w,w as g,o as P,m as E,n as R,p as D,s as A,t as q,v as b,r as d}from"./index-DbrDj4Du.js";const p="products",h=n=>{const t=n.data();return{id:n.id,...t,createdAt:t.createdAt?.toDate(),updatedAt:t.updatedAt?.toDate()}},F=n=>({...n,createdAt:new Date,updatedAt:new Date});class y{static async getAllProducts(){try{const t=f(m(l,p));return(await w(t)).docs.map(c=>{const s=h(c);return{id:s.id,name:s.name,price:s.price,moq:s.moq,category:s.category,image:s.images[0]?.url||"",supplier:s.supplier,description:s.description,variants:s.variants?.map(a=>a.name)||[],stock:s.stock,tags:s.tags||[],discount:s.discount}})}catch(t){throw console.error("Erreur lors de la récupération des produits:",t),new Error("Impossible de charger les produits")}}static async getProductsByCategory(t){try{const r=f(m(l,p),g("category","==",t),g("active","==",!0),P("createdAt","desc"));return(await w(r)).docs.map(s=>{const a=h(s);return{id:a.id,name:a.name,price:a.price,moq:a.moq,category:a.category,image:a.images[0]?.url||"",supplier:a.supplier,description:a.description,variants:a.variants.map(i=>i.name),stock:a.stock,tags:a.tags,discount:a.discount}})}catch(r){throw console.error("Erreur lors de la récupération des produits par catégorie:",r),new Error("Impossible de charger les produits de cette catégorie")}}static async getProductById(t){try{const r=E(l,p,t),c=await R(r);return c.exists()?h(c):null}catch(r){throw console.error("Erreur lors de la récupération du produit:",r),new Error("Impossible de charger le produit")}}static async searchProducts(t){try{const r=f(m(l,p),g("active","==",!0),P("name")),s=(await w(r)).docs.map(i=>{const o=h(i);return{id:o.id,name:o.name,price:o.price,moq:o.moq,category:o.category,image:o.images[0]?.url||"",supplier:o.supplier,description:o.description,variants:o.variants.map(e=>e.name),stock:o.stock,tags:o.tags,discount:o.discount}}),a=t.toLowerCase();return s.filter(i=>i.name.toLowerCase().includes(a)||i.description.toLowerCase().includes(a)||i.tags.some(o=>o.toLowerCase().includes(a)))}catch(r){throw console.error("Erreur lors de la recherche de produits:",r),new Error("Impossible de rechercher les produits")}}static async getSimilarProducts(t,r,c=3){try{const s=f(m(l,p),g("category","==",r),g("active","==",!0),P("createdAt","desc"),D(c+1));return(await w(s)).docs.map(o=>{const e=h(o);return{id:e.id,name:e.name,price:e.price,moq:e.moq,category:e.category,image:e.images[0]?.url||"",supplier:e.supplier,description:e.description,variants:e.variants.map(u=>u.name),stock:e.stock,tags:e.tags,discount:e.discount}}).filter(o=>o.id!==t).slice(0,c)}catch(s){throw console.error("Erreur lors de la récupération des produits similaires:",s),new Error("Impossible de charger les produits similaires")}}static async addProduct(t){try{const r=F(t);return(await A(m(l,p),{...r,active:!0})).id}catch(r){throw console.error("Erreur lors de l'ajout du produit:",r),new Error("Impossible d'ajouter le produit")}}static async updateProduct(t,r){try{const c=E(l,p,t);await q(c,{...r,updatedAt:new Date})}catch(c){throw console.error("Erreur lors de la mise à jour du produit:",c),new Error("Impossible de mettre à jour le produit")}}static async deleteProduct(t){try{const r=E(l,p,t);await q(r,{active:!1,updatedAt:new Date})}catch(r){throw console.error("Erreur lors de la suppression du produit:",r),new Error("Impossible de supprimer le produit")}}static async permanentDeleteProduct(t){try{const r=E(l,p,t);await b(r)}catch(r){throw console.error("Erreur lors de la suppression définitive du produit:",r),new Error("Impossible de supprimer définitivement le produit")}}}const k=()=>{const[n,t]=d.useState([]),[r,c]=d.useState(!0),[s,a]=d.useState(null);return d.useEffect(()=>{(async()=>{try{c(!0),a(null);const e=await y.getAllProducts();t(e)}catch(e){a(e instanceof Error?e.message:"Erreur inconnue"),console.error("Erreur lors du chargement des produits:",e)}finally{c(!1)}})()},[]),{products:n,loading:r,error:s,refetch:async()=>{try{c(!0),a(null);const o=await y.getAllProducts();t(o)}catch(o){a(o instanceof Error?o.message:"Erreur inconnue"),console.error("Erreur lors du rechargement des produits:",o)}finally{c(!1)}}}},x=n=>{const[t,r]=d.useState(null),[c,s]=d.useState(!0),[a,i]=d.useState(null);return d.useEffect(()=>{if(!n){s(!1);return}(async()=>{try{s(!0),i(null);const u=await y.getProductById(n);r(u)}catch(u){i(u instanceof Error?u.message:"Erreur inconnue"),console.error("Erreur lors du chargement du produit:",u)}finally{s(!1)}})()},[n]),{product:t,loading:c,error:a,refetch:async()=>{if(n)try{s(!0),i(null);const e=await y.getProductById(n);r(e)}catch(e){i(e instanceof Error?e.message:"Erreur inconnue"),console.error("Erreur lors du rechargement du produit:",e)}finally{s(!1)}}}},C=(n,t)=>{const[r,c]=d.useState([]),[s,a]=d.useState(!0),[i,o]=d.useState(null);return d.useEffect(()=>{if(!n||!t){a(!1);return}(async()=>{try{a(!0),o(null);const u=await y.getSimilarProducts(n,t,3);c(u)}catch(u){o(u instanceof Error?u.message:"Erreur inconnue"),console.error("Erreur lors du chargement des produits similaires:",u)}finally{a(!1)}})()},[n,t]),{products:r,loading:s,error:i}},I=n=>{const[t,r]=d.useState(n),[c,s]=d.useState({category:"Toutes",priceRange:{min:0,max:10},moqRange:{min:0,max:500}});return d.useEffect(()=>{const o=n.filter(e=>{const u=c.category==="Toutes"||e.category===c.category,S=e.price>=c.priceRange.min&&e.price<=c.priceRange.max,v=e.moq>=c.moqRange.min&&e.moq<=c.moqRange.max;return u&&S&&v});r(o)},[n,c]),{filteredProducts:t,filters:c,updateFilters:o=>{s(e=>({...e,...o}))},resetFilters:()=>{s({category:"Toutes",priceRange:{min:0,max:10},moqRange:{min:0,max:500}})}}};export{I as a,x as b,C as c,k as u};
