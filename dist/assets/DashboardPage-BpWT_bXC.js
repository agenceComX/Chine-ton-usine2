import{i as J,k as S,l as K,m as R,n as te,a3 as ae,t as Q,v as le,q as ie,w as ne,y as ce,r as l,j as e,U as M,a as oe}from"./index-DbrDj4Du.js";import{B as o}from"./Button-BXIi94zn.js";import{I as x}from"./Input-CQoVujND.js";import{S as A}from"./Select-BE-U7Uex.js";import{A as de}from"./AdminLayout-DJvW88_N.js";import{P as ue}from"./plus-7lddUlfR.js";import{P as me}from"./pencil-B4x0pJEy.js";import{T as xe}from"./trash-2-ZdXwmmSk.js";import"./chart-column-zn556lbz.js";import"./shield-K9SayZ_V.js";class he{async getUsers(){try{const t=J(S,"users");return(await K(t)).docs.map(b=>({id:b.id,...b.data()}))}catch(t){throw console.error("Erreur lors de la récupération des utilisateurs:",t),new Error("Impossible de récupérer les utilisateurs.")}}async getUserById(t){try{const a=R(S,"users",t),r=await te(a);return r.exists()?{id:r.id,...r.data()}:null}catch(a){throw console.error("Erreur lors de la récupération de l'utilisateur par ID:",a),new Error("Impossible de récupérer l'utilisateur.")}}async createUser(t,a,r,b){try{const i=await ae.signUp(t,a,r,b);if(i.error||!i.user)throw new Error(i.error||"Erreur lors de la création de l'utilisateur.");return i.user}catch(i){throw console.error("Erreur lors de la création de l'utilisateur:",i),new Error("Impossible de créer l'utilisateur.")}}async updateUser(t,a){try{const r=R(S,"users",t);await Q(r,{...a,updated_at:new Date().toISOString()})}catch(r){throw console.error("Erreur lors de la mise à jour de l'utilisateur:",r),new Error("Impossible de mettre à jour l'utilisateur.")}}async deleteUser(t){try{await le(R(S,"users",t))}catch(a){throw console.error("Erreur lors de la suppression de l'utilisateur:",a),new Error("Impossible de supprimer l'utilisateur.")}}async searchUsers(t,a){try{let r=J(S,"users");if(t){const k=(await this.getUsers()).filter(p=>p.email.toLowerCase().includes(t.toLowerCase())||p.name?.toLowerCase().includes(t.toLowerCase()));return a?k.filter(p=>p.role===a):k}return a&&(r=ie(r,ne("role","==",a))),(await K(r)).docs.map(n=>({id:n.id,...n.data()}))}catch(r){throw console.error("Erreur lors de la recherche des utilisateurs:",r),new Error("Impossible de rechercher les utilisateurs.")}}async updateUserLanguage(t,a){try{const r=R(S,"users",t);await Q(r,{language:a,updated_at:new Date().toISOString()})}catch(r){console.error("Erreur lors de la mise à jour de la langue utilisateur:",r)}}}const D=new he,Se=()=>{const{user:$}=ce(),[t,a]=l.useState("overview"),[r,b]=l.useState([]),[i,n]=l.useState(!1),[k,p]=l.useState(!1),[O,E]=l.useState(!1),[_,q]=l.useState(!1),[m,I]=l.useState(null),[z,W]=l.useState(""),[F,X]=l.useState(""),[y,w]=l.useState(""),[P,B]=l.useState(""),[j,N]=l.useState(""),[v,C]=l.useState("customer"),[d,h]=l.useState(""),[u,g]=l.useState(""),U=async()=>{n(!0);try{const s=await D.getUsers();b(s)}catch(s){console.error("Erreur lors du chargement des utilisateurs:",s),h(s instanceof Error?s.message:"Erreur lors du chargement des utilisateurs")}finally{n(!1)}};l.useEffect(()=>{U()},[]);const T=r.filter(s=>{const c=s.email.toLowerCase().includes(z.toLowerCase())||s.name?.toLowerCase().includes(z.toLowerCase()),re=!F||s.role===F;return c&&re}),L={totalUsers:r.length,totalSuppliers:r.filter(s=>s.role==="supplier").length,totalCustomers:r.filter(s=>s.role==="customer").length,totalAdmins:r.filter(s=>s.role==="admin").length},G=async s=>{s.preventDefault(),h(""),g(""),n(!0);try{await D.createUser(y,P,j,v),g(`Utilisateur ${y} créé avec succès`),p(!1),f(),U()}catch(c){console.error("Erreur lors de la création:",c),h(c instanceof Error?c.message:"Erreur lors de la création de l'utilisateur")}finally{n(!1)}},V=async()=>{if(m){h(""),g(""),n(!0);try{await D.deleteUser(m.id),g(`Utilisateur ${m.email} supprimé avec succès`),q(!1),I(null),U()}catch(s){console.error("Erreur lors de la suppression:",s),h(s instanceof Error?s.message:"Erreur lors de la suppression de l'utilisateur")}finally{n(!1)}}},f=()=>{w(""),B(""),N(""),C("customer"),I(null),h(""),g("")},Y=s=>{I(s),w(s.email),N(s.name),C(s.role),E(!0)},Z=s=>{I(s),q(!0)},H=()=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Utilisateurs totaux"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:L.totalUsers})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Fournisseurs"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:L.totalSuppliers})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Clients"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:L.totalCustomers})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Administrateurs"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:L.totalAdmins})]})]})})]}),ee=()=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6 flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Gestion des utilisateurs"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[T.length," utilisateur(s) trouvé(s)"]})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex flex-col sm:flex-row gap-4",children:[e.jsx(x,{type:"text",placeholder:"Rechercher par email ou nom...",value:z,onChange:s=>W(s.target.value),className:"w-full sm:w-64",leftIcon:e.jsx(oe,{className:"h-5 w-5 text-gray-400"})}),e.jsx(A,{value:F,onChange:s=>X(s.target.value),options:[{value:"",label:"Tous les rôles"},{value:"customer",label:"Client"},{value:"supplier",label:"Fournisseur"},{value:"admin",label:"Administrateur"}],className:"w-full sm:w-40"}),e.jsxs(o,{onClick:()=>p(!0),variant:"primary",className:"flex items-center justify-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Ajouter un utilisateur"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:i?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("span",{className:"text-gray-500",children:"Chargement des utilisateurs..."})}):T.length===0?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("span",{className:"text-gray-500",children:"Aucun utilisateur trouvé."})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rôle"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:T.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:s.role}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>Y(s),className:"text-blue-600 hover:text-blue-900 mr-4",children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>Z(s),className:"text-red-600 hover:text-red-900",children:e.jsx(xe,{className:"h-5 w-5"})})]})]},s.id))})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Ajouter un nouvel utilisateur"}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsx(x,{label:"Email",type:"email",value:y,onChange:s=>w(s.target.value),required:!0}),e.jsx(x,{label:"Mot de passe",type:"password",value:P,onChange:s=>B(s.target.value),required:!0,minLength:6}),e.jsx(x,{label:"Nom",type:"text",value:j,onChange:s=>N(s.target.value),required:!0}),e.jsx(A,{label:"Rôle",value:v,onChange:s=>C(s.target.value),options:[{value:"customer",label:"Client"},{value:"supplier",label:"Fournisseur"},{value:"admin",label:"Administrateur"},{value:"sourcer",label:"Sourcer"}]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>{p(!1),f()},children:"Annuler"}),e.jsx(o,{type:"submit",variant:"primary",disabled:i,children:"Ajouter"})]})]})]})}),O&&m&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Modifier l'utilisateur"}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("form",{onSubmit:async s=>{s.preventDefault(),h(""),g(""),n(!0);try{await D.updateUser(m.id,{email:y,name:j,role:v}),g("Utilisateur mis à jour avec succès"),E(!1),f(),U()}catch(c){console.error("Erreur lors de la mise à jour:",c),h(c instanceof Error?c.message:"Erreur lors de la mise à jour de l'utilisateur")}finally{n(!1)}},className:"space-y-4",children:[e.jsx(x,{label:"Email",type:"email",value:y,onChange:s=>w(s.target.value),required:!0,disabled:!0}),e.jsx(x,{label:"Nom",type:"text",value:j,onChange:s=>N(s.target.value),required:!0}),e.jsx(A,{label:"Rôle",value:v,onChange:s=>C(s.target.value),options:[{value:"customer",label:"Client"},{value:"supplier",label:"Fournisseur"},{value:"admin",label:"Administrateur"},{value:"sourcer",label:"Sourcer"}]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>{E(!1),f()},children:"Annuler"}),e.jsx(o,{type:"submit",variant:"primary",disabled:i,children:"Mettre à jour"})]})]})]})}),_&&m&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Confirmer la suppression"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Êtes-vous sûr de vouloir supprimer l'utilisateur ",e.jsx("span",{className:"font-semibold",children:m.email})," ? Cette action est irréversible."]}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>q(!1),children:"Annuler"}),e.jsx(o,{type:"button",variant:"danger",onClick:V,disabled:i,children:"Supprimer"})]})]})})]}),se=()=>{switch(t){case"overview":return H();case"users":return ee();default:return H()}};return e.jsx(de,{children:e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-blue-800 pb-32",children:e.jsx("header",{className:"py-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Administration"}),e.jsxs("p",{className:"text-blue-100 mt-2",children:["Bienvenue, ",$?.name]})]})})}),e.jsx("main",{className:"-mt-32",children:e.jsx("div",{className:"max-w-7xl mx-auto pb-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow px-5 py-6 sm:px-6",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>a("overview"),className:`${t==="overview"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Vue d'ensemble"}),e.jsx("button",{onClick:()=>a("users"),className:`${t==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Utilisateurs"})]})}),se()]})})}),k&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Ajouter un nouvel utilisateur"}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsx(x,{label:"Email",type:"email",value:y,onChange:s=>w(s.target.value),required:!0}),e.jsx(x,{label:"Mot de passe",type:"password",value:P,onChange:s=>B(s.target.value),required:!0,minLength:6}),e.jsx(x,{label:"Nom",type:"text",value:j,onChange:s=>N(s.target.value),required:!0}),e.jsx(A,{label:"Rôle",value:v,onChange:s=>C(s.target.value),options:[{value:"customer",label:"Client"},{value:"supplier",label:"Fournisseur"},{value:"admin",label:"Administrateur"},{value:"sourcer",label:"Sourcer"}]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>{p(!1),f()},children:"Annuler"}),e.jsx(o,{type:"submit",variant:"primary",disabled:i,children:"Ajouter"})]})]})]})}),O&&m&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Modifier l'utilisateur"}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("form",{onSubmit:async s=>{s.preventDefault(),h(""),g(""),n(!0);try{await D.updateUser(m.id,{email:y,name:j,role:v}),g("Utilisateur mis à jour avec succès"),E(!1),f(),U()}catch(c){console.error("Erreur lors de la mise à jour:",c),h(c instanceof Error?c.message:"Erreur lors de la mise à jour de l'utilisateur")}finally{n(!1)}},className:"space-y-4",children:[e.jsx(x,{label:"Email",type:"email",value:y,onChange:s=>w(s.target.value),required:!0,disabled:!0}),e.jsx(x,{label:"Nom",type:"text",value:j,onChange:s=>N(s.target.value),required:!0}),e.jsx(A,{label:"Rôle",value:v,onChange:s=>C(s.target.value),options:[{value:"customer",label:"Client"},{value:"supplier",label:"Fournisseur"},{value:"admin",label:"Administrateur"},{value:"sourcer",label:"Sourcer"}]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>{E(!1),f()},children:"Annuler"}),e.jsx(o,{type:"submit",variant:"primary",disabled:i,children:"Mettre à jour"})]})]})]})}),_&&m&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Confirmer la suppression"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Êtes-vous sûr de vouloir supprimer l'utilisateur ",e.jsx("span",{className:"font-semibold",children:m.email})," ? Cette action est irréversible."]}),d&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",children:d}),u&&e.jsx("div",{className:"mb-4 text-green-600 text-sm",children:u}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>q(!1),children:"Annuler"}),e.jsx(o,{type:"button",variant:"danger",onClick:V,disabled:i,children:"Supprimer"})]})]})})]})})};export{Se as default};
