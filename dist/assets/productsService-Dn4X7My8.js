import{W as s}from"./index-DbrDj4Du.js";const i="global_products_list";class o{static instance;listeners=[];static getInstance(){return o.instance||(o.instance=new o),o.instance}subscribe(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(r=>r!==t)}}notifyListeners(){this.listeners.forEach(t=>{try{t()}catch(r){console.error("Erreur lors de la notification d'un listener:",r)}})}getAllProducts(){try{const t=localStorage.getItem(i);if(console.log("ðŸ” ProductsService: localStorage contenu:",t?"DonnÃ©es prÃ©sentes":"Aucune donnÃ©e"),t){const r=JSON.parse(t);if(Array.isArray(r)&&r.length>0)return console.log("ðŸ” ProductsService: Produits chargÃ©s depuis localStorage:",r.length),r;console.log("âš ï¸ ProductsService: localStorage contient un tableau vide ou invalide")}}catch(t){console.error("âŒ ProductsService: Erreur lors du chargement depuis localStorage:",t)}return console.log("ï¿½ ProductsService: Initialisation avec produits par dÃ©faut:",s?.length||"ERREUR D'IMPORT"),!s||!Array.isArray(s)||s.length===0?(console.error("âŒ ProductsService: ERREUR CRITIQUE - Aucun produit initial trouvÃ© !"),[]):(this.saveProducts(s),s)}saveProducts(t){try{localStorage.setItem(i,JSON.stringify(t)),this.notifyListeners()}catch(r){console.error("Erreur lors de la sauvegarde des produits globaux:",r)}}addProduct(t){const r=this.getAllProducts(),e=[t,...r];this.saveProducts(e)}updateProduct(t,r){const c=this.getAllProducts().map(n=>n.id===t?{...n,...r}:n);this.saveProducts(c)}forceReset(){localStorage.removeItem(i),console.log("ðŸ”„ ProductsService: localStorage effacÃ©, rÃ©initialisation forcÃ©e"),this.saveProducts(s)}deleteProduct(t){const e=this.getAllProducts().filter(c=>c.id!==t);this.saveProducts(e)}getSupplierProducts(t){const r=this.getAllProducts();return t?r.filter(e=>e.supplierId===t):r}getProductById(t){return this.getAllProducts().find(e=>e.id===t)}resetToDefault(){this.saveProducts(s)}syncSupplierProducts(t){const r=this.getAllProducts(),e=t.map(u=>u.id),c=r.filter(u=>!e.includes(u.id)),n=[...t,...c];this.saveProducts(n)}}const d=o.getInstance();export{d as p};
